"""
FirstPerson - Emotional AI Companion
Main entry point for the Streamlit pages app.
"""
import streamlit as st
from emotional_os.deploy.modules.auth import SaoynxAuthentication

# Page configuration must be the first Streamlit command
st.set_page_config(
    page_title="FirstPerson - Emotional AI Companion",
    page_icon="ðŸ§ ",
    layout="wide",
    initial_sidebar_state="collapsed"
)

# Customize navigation text
st.markdown("""
    <style>
    div.st-emotion-cache-j7qwjs span.st-emotion-cache-6tkfeg {
        visibility: hidden;
        position: relative;
    }
    
    div.st-emotion-cache-j7qwjs span.st-emotion-cache-6tkfeg::before {
        visibility: visible;
        position: absolute;
        content: "FirstPerson - Emotional AI Companion";
        left: 0;
    }
    </style>
""", unsafe_allow_html=True)


# Optional local preprocessor (privacy-first steward)
try:
    from local_inference.preprocessor import Preprocessor
    PREPROCESSOR_AVAILABLE = True
except Exception:
    Preprocessor = None
    PREPROCESSOR_AVAILABLE = False

# Optional limbic integration (safe import)
try:
    from emotional_os.glyphs.limbic_integration import LimbicIntegrationEngine
    HAS_LIMBIC = True
except Exception:
    LimbicIntegrationEngine = None
    HAS_LIMBIC = False


def get_page_icon():
    try:
        logo_path = Path(
            "static/graphics/FirstPerson-Logo-black-cropped_notext.svg")
        if logo_path.exists():
            return str(logo_path)
    except Exception:
        pass
    return None


# Customize navigation text
st.markdown("""
    <style>
    div.st-emotion-cache-j7qwjs span.st-emotion-cache-6tkfeg {
        visibility: hidden;
        position: relative;
    }
    
    div.st-emotion-cache-j7qwjs span.st-emotion-cache-6tkfeg::before {
        visibility: visible;
        position: absolute;
        content: "FirstPerson - Emotional AI Companion";
        left: 0;
    }
    </style>
""", unsafe_allow_html=True)


def main():
    """Main entry point that redirects to the appropriate page based on authentication."""
    # Initialize the authentication system
    auth = SaoynxAuthentication()

    # Redirect to appropriate page based on authentication
    if not st.session_state.get("authenticated", False):
        st.switch_page("pages/1_ðŸ”’_Login.py")
    else:
        st.switch_page("pages/2_ðŸ’­_Dashboard.py")


if __name__ == "__main__":
    main()
