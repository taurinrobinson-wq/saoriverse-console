{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/saoriverse-console/firstperson-web/src/app/chat/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { useStore } from \"@/lib/store\";\r\nimport { api } from \"@/lib/api\";\r\nimport { AudioRecorder } from \"@/components/AudioRecorder\";\r\nimport { ResponseDisplay } from \"@/components/ResponseDisplay\";\r\nimport { DanceAnimation } from \"@/components/DanceAnimation\";\r\nimport { Settings, Send } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\n\r\ninterface Message {\r\n  id: string;\r\n  type: \"user\" | \"assistant\";\r\n  text: string;\r\n  glyphIntent?: string;\r\n  audioUrl?: string;\r\n  timestamp: Date;\r\n  emotion?: string;\r\n}\r\n\r\nexport default function ChatPage() {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [inputText, setInputText] = useState(\"\");\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showDance, setShowDance] = useState(false);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const { recordingStatus, selectedModel } = useStore();\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  const handleSendMessage = async (text: string) => {\r\n    if (!text.trim()) return;\r\n\r\n    const userMessage: Message = {\r\n      id: Date.now().toString(),\r\n      type: \"user\",\r\n      text: text,\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    setMessages((prev) => [...prev, userMessage]);\r\n    setInputText(\"\");\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      const response = await api.chat(text);\r\n\r\n      const shouldDance = detectExcitement(response.response_text);\r\n      if (shouldDance) {\r\n        setShowDance(true);\r\n        setTimeout(() => setShowDance(false), 3000);\r\n      }\r\n\r\n      const assistantMessage: Message = {\r\n        id: (Date.now() + 1).toString(),\r\n        type: \"assistant\",\r\n        text: response.response_text,\r\n        glyphIntent: response.glyph_intent,\r\n        emotion: response.emotion,\r\n        timestamp: new Date(),\r\n      };\r\n\r\n      setMessages((prev) => [...prev, assistantMessage]);\r\n\r\n      if (response.glyph_intent) {\r\n        try {\r\n          const audioUrl = await api.synthesize(\r\n            response.response_text,\r\n            response.glyph_intent\r\n          );\r\n          setMessages((prev) =>\r\n            prev.map((msg) =>\r\n              msg.id === assistantMessage.id ? { ...msg, audioUrl } : msg\r\n            )\r\n          );\r\n        } catch (error) {\r\n          console.error(\"Audio synthesis failed:\", error);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Chat error:\", error);\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        {\r\n          id: (Date.now() + 1).toString(),\r\n          type: \"assistant\",\r\n          text: \"Sorry, something went wrong. Please try again.\",\r\n          timestamp: new Date(),\r\n        },\r\n      ]);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const detectExcitement = (text: string): boolean => {\r\n    const excitementPatterns = [\r\n      /amazing/i,\r\n      /awesome/i,\r\n      /wonderful/i,\r\n      /exciting/i,\r\n      /fantastic/i,\r\n      /love/i,\r\n      /beautiful/i,\r\n      /ðŸŽ‰|ðŸŽŠ|âœ¨|ðŸŒŸ|ðŸ’«/,\r\n    ];\r\n    return excitementPatterns.some((pattern) => pattern.test(text));\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-screen bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900\">\r\n      <motion.div\r\n        className=\"bg-slate-800/80 backdrop-blur-md border-b border-slate-700 px-6 py-4 flex items-center justify-between\"\r\n        initial={{ y: -100 }}\r\n        animate={{ y: 0 }}\r\n        transition={{ duration: 0.5 }}\r\n      >\r\n        <motion.div\r\n          className=\"text-2xl font-bold bg-gradient-to-r from-indigo-400 to-blue-400 bg-clip-text text-transparent flex items-center gap-3\"\r\n          whileHover={{ scale: 1.05 }}\r\n        >\r\n          <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-600 to-blue-600 flex items-center justify-center text-xl\">\r\n            ðŸ§ \r\n          </div>\r\n          FirstPerson Chat\r\n        </motion.div>\r\n\r\n        <div className=\"flex items-center gap-4\">\r\n          <motion.span\r\n            className=\"text-sm text-indigo-300 px-3 py-1 bg-slate-700 rounded-full\"\r\n            animate={{ opacity: [0.7, 1, 0.7] }}\r\n            transition={{ duration: 2, repeat: Infinity }}\r\n          >\r\n            {selectedModel || \"Local AI\"}\r\n          </motion.span>\r\n\r\n          <Link href=\"/settings\">\r\n            <motion.button\r\n              className=\"p-2 hover:bg-slate-700 rounded-lg transition-colors\"\r\n              whileHover={{ scale: 1.1, rotate: 90 }}\r\n              whileTap={{ scale: 0.95 }}\r\n            >\r\n              <Settings className=\"w-5 h-5 text-indigo-300\" />\r\n            </motion.button>\r\n          </Link>\r\n        </div>\r\n      </motion.div>\r\n\r\n      <div className=\"flex-1 overflow-y-auto px-6 py-6 space-y-4 custom-scrollbar\">\r\n        <AnimatePresence>\r\n          {messages.length === 0 && (\r\n            <motion.div\r\n              className=\"flex items-center justify-center h-full\"\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n            >\r\n              <div className=\"text-center space-y-4\">\r\n                <motion.div\r\n                  className=\"text-6xl\"\r\n                  animate={{ y: [0, -20, 0] }}\r\n                  transition={{ duration: 3, repeat: Infinity }}\r\n                >\r\n                  ðŸŽ¤\r\n                </motion.div>\r\n                <p className=\"text-xl text-slate-400\">\r\n                  Start your conversation by speaking or typing\r\n                </p>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {messages.map((message) => (\r\n            <motion.div\r\n              key={message.id}\r\n              initial={{ opacity: 0, y: 20 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -20 }}\r\n              transition={{ duration: 0.3 }}\r\n              className={`flex ${\r\n                message.type === \"user\" ? \"justify-end\" : \"justify-start\"\r\n              }`}\r\n            >\r\n              <motion.div\r\n                className={`max-w-xs lg:max-w-md px-4 py-3 rounded-2xl ${\r\n                  message.type === \"user\"\r\n                    ? \"bg-gradient-to-br from-indigo-600 to-blue-600 text-white\"\r\n                    : \"bg-slate-800 text-slate-100 border border-slate-700\"\r\n                }`}\r\n                whileHover={{ scale: 1.02 }}\r\n                transition={{ duration: 0.2 }}\r\n              >\r\n                <p className=\"text-sm leading-relaxed\">{message.text}</p>\r\n\r\n                {message.type === \"assistant\" && (\r\n                  <div className=\"mt-2 flex items-center gap-2 text-xs text-slate-400\">\r\n                    {message.emotion && (\r\n                      <span className=\"px-2 py-1 bg-slate-700 rounded-full\">\r\n                        {message.emotion}\r\n                      </span>\r\n                    )}\r\n                    {message.audioUrl && (\r\n                      <motion.button\r\n                        className=\"px-2 py-1 bg-indigo-600 rounded-full text-indigo-100 hover:bg-indigo-700\"\r\n                        whileHover={{ scale: 1.05 }}\r\n                        whileTap={{ scale: 0.95 }}\r\n                        onClick={() => {\r\n                          const audio = new Audio(message.audioUrl);\r\n                          audio.play();\r\n                        }}\r\n                      >\r\n                        ðŸ”Š Play\r\n                      </motion.button>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </motion.div>\r\n            </motion.div>\r\n          ))}\r\n\r\n          {isLoading && (\r\n            <motion.div\r\n              className=\"flex justify-start\"\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n            >\r\n              <div className=\"flex gap-2 px-4 py-3 bg-slate-800 rounded-2xl border border-slate-700\">\r\n                {[0, 1, 2].map((i) => (\r\n                  <motion.div\r\n                    key={i}\r\n                    className=\"w-2 h-2 bg-indigo-400 rounded-full\"\r\n                    animate={{\r\n                      y: [0, -10, 0],\r\n                    }}\r\n                    transition={{\r\n                      duration: 0.6,\r\n                      repeat: Infinity,\r\n                      delay: i * 0.1,\r\n                    }}\r\n                  />\r\n                ))}\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      <AnimatePresence>\r\n        {showDance && <DanceAnimation />}\r\n      </AnimatePresence>\r\n\r\n      <motion.div\r\n        className=\"bg-slate-800/80 backdrop-blur-md border-t border-slate-700 px-6 py-4 space-y-4\"\r\n        initial={{ y: 100 }}\r\n        animate={{ y: 0 }}\r\n        transition={{ duration: 0.5, delay: 0.1 }}\r\n      >\r\n        <div className=\"flex gap-3\">\r\n          <motion.input\r\n            type=\"text\"\r\n            value={inputText}\r\n            onChange={(e) => setInputText(e.target.value)}\r\n            onKeyPress={(e) => {\r\n              if (e.key === \"Enter\" && !e.shiftKey) {\r\n                e.preventDefault();\r\n                handleSendMessage(inputText);\r\n              }\r\n            }}\r\n            placeholder=\"Type a message or use voice...\"\r\n            className=\"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:border-indigo-500 transition-colors\"\r\n            whileFocus={{ scale: 1.02 }}\r\n          />\r\n\r\n          <motion.button\r\n            onClick={() => handleSendMessage(inputText)}\r\n            disabled={!inputText.trim() || isLoading}\r\n            className=\"px-4 py-3 bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-white font-medium transition-all\"\r\n            whileHover={{ scale: 1.05 }}\r\n            whileTap={{ scale: 0.95 }}\r\n          >\r\n            <Send className=\"w-5 h-5\" />\r\n          </motion.button>\r\n        </div>\r\n\r\n        <AudioRecorder\r\n          onTranscription={(text) => handleSendMessage(text)}\r\n          isLoading={isLoading}\r\n        />\r\n      </motion.div>\r\n\r\n      <style jsx global>{`\r\n        .custom-scrollbar::-webkit-scrollbar {\r\n          width: 8px;\r\n        }\r\n        .custom-scrollbar::-webkit-scrollbar-track {\r\n          background: transparent;\r\n        }\r\n        .custom-scrollbar::-webkit-scrollbar-thumb {\r\n          background: rgba(99, 102, 241, 0.3);\r\n          border-radius: 4px;\r\n        }\r\n        .custom-scrollbar::-webkit-scrollbar-thumb:hover {\r\n          background: rgba(99, 102, 241, 0.5);\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;AAMA;AAAA;AACA;;;AAVA;;;;;;;;;;AAsBe,SAAS;;IACtB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAY,EAAE;IACtD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,iBAAiB,IAAA,uKAAM,EAAiB;IAC9C,MAAM,EAAE,eAAe,EAAE,aAAa,EAAE,GAAG;IAE3C,MAAM,iBAAiB;QACrB,eAAe,OAAO,EAAE,eAAe;YAAE,UAAU;QAAS;IAC9D;IAEA,IAAA,0KAAS;8BAAC;YACR;QACF;6BAAG;QAAC;KAAS;IAEb,MAAM,oBAAoB,OAAO;QAC/B,IAAI,CAAC,KAAK,IAAI,IAAI;QAElB,MAAM,cAAuB;YAC3B,IAAI,KAAK,GAAG,GAAG,QAAQ;YACvB,MAAM;YACN,MAAM;YACN,WAAW,IAAI;QACjB;QAEA,YAAY,CAAC,OAAS;mBAAI;gBAAM;aAAY;QAC5C,aAAa;QACb,aAAa;QAEb,IAAI;YACF,MAAM,WAAW,MAAM,IAAI,IAAI,CAAC;YAEhC,MAAM,cAAc,iBAAiB,SAAS,aAAa;YAC3D,IAAI,aAAa;gBACf,aAAa;gBACb,WAAW,IAAM,aAAa,QAAQ;YACxC;YAEA,MAAM,mBAA4B;gBAChC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,EAAE,QAAQ;gBAC7B,MAAM;gBACN,MAAM,SAAS,aAAa;gBAC5B,aAAa,SAAS,YAAY;gBAClC,SAAS,SAAS,OAAO;gBACzB,WAAW,IAAI;YACjB;YAEA,YAAY,CAAC,OAAS;uBAAI;oBAAM;iBAAiB;YAEjD,IAAI,SAAS,YAAY,EAAE;gBACzB,IAAI;oBACF,MAAM,WAAW,MAAM,IAAI,UAAU,CACnC,SAAS,aAAa,EACtB,SAAS,YAAY;oBAEvB,YAAY,CAAC,OACX,KAAK,GAAG,CAAC,CAAC,MACR,IAAI,EAAE,KAAK,iBAAiB,EAAE,GAAG;gCAAE,GAAG,GAAG;gCAAE;4BAAS,IAAI;gBAG9D,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,2BAA2B;gBAC3C;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,eAAe;YAC7B,YAAY,CAAC,OAAS;uBACjB;oBACH;wBACE,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,EAAE,QAAQ;wBAC7B,MAAM;wBACN,MAAM;wBACN,WAAW,IAAI;oBACjB;iBACD;QACH,SAAU;YACR,aAAa;QACf;IACF;IAEA,MAAM,mBAAmB,CAAC;QACxB,MAAM,qBAAqB;YACzB;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD,OAAO,mBAAmB,IAAI,CAAC,CAAC,UAAY,QAAQ,IAAI,CAAC;IAC3D;IAEA,qBACE,6LAAC;kDAAc;;0BACb,6LAAC,uMAAM,CAAC,GAAG;gBACT,WAAU;gBACV,SAAS;oBAAE,GAAG,CAAC;gBAAI;gBACnB,SAAS;oBAAE,GAAG;gBAAE;gBAChB,YAAY;oBAAE,UAAU;gBAAI;;kCAE5B,6LAAC,uMAAM,CAAC,GAAG;wBACT,WAAU;wBACV,YAAY;4BAAE,OAAO;wBAAK;;0CAE1B,6LAAC;0EAAc;0CAAgH;;;;;;4BAEzH;;;;;;;kCAIR,6LAAC;kEAAc;;0CACb,6LAAC,uMAAM,CAAC,IAAI;gCACV,WAAU;gCACV,SAAS;oCAAE,SAAS;wCAAC;wCAAK;wCAAG;qCAAI;gCAAC;gCAClC,YAAY;oCAAE,UAAU;oCAAG,QAAQ;gCAAS;0CAE3C,iBAAiB;;;;;;0CAGpB,6LAAC,0KAAI;gCAAC,MAAK;0CACT,cAAA,6LAAC,uMAAM,CAAC,MAAM;oCACZ,WAAU;oCACV,YAAY;wCAAE,OAAO;wCAAK,QAAQ;oCAAG;oCACrC,UAAU;wCAAE,OAAO;oCAAK;8CAExB,cAAA,6LAAC,yNAAQ;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAM5B,6LAAC;0DAAc;;kCACb,6LAAC,+MAAe;;4BACb,SAAS,MAAM,KAAK,mBACnB,6LAAC,uMAAM,CAAC,GAAG;gCACT,WAAU;gCACV,SAAS;oCAAE,SAAS;gCAAE;gCACtB,SAAS;oCAAE,SAAS;gCAAE;gCACtB,MAAM;oCAAE,SAAS;gCAAE;0CAEnB,cAAA,6LAAC;8EAAc;;sDACb,6LAAC,uMAAM,CAAC,GAAG;4CACT,WAAU;4CACV,SAAS;gDAAE,GAAG;oDAAC;oDAAG,CAAC;oDAAI;iDAAE;4CAAC;4CAC1B,YAAY;gDAAE,UAAU;gDAAG,QAAQ;4CAAS;sDAC7C;;;;;;sDAGD,6LAAC;sFAAY;sDAAyB;;;;;;;;;;;;;;;;;4BAO3C,SAAS,GAAG,CAAC,CAAC,wBACb,6LAAC,uMAAM,CAAC,GAAG;oCAET,SAAS;wCAAE,SAAS;wCAAG,GAAG;oCAAG;oCAC7B,SAAS;wCAAE,SAAS;wCAAG,GAAG;oCAAE;oCAC5B,MAAM;wCAAE,SAAS;wCAAG,GAAG,CAAC;oCAAG;oCAC3B,YAAY;wCAAE,UAAU;oCAAI;oCAC5B,WAAW,CAAC,KAAK,EACf,QAAQ,IAAI,KAAK,SAAS,gBAAgB,iBAC1C;8CAEF,cAAA,6LAAC,uMAAM,CAAC,GAAG;wCACT,WAAW,CAAC,2CAA2C,EACrD,QAAQ,IAAI,KAAK,SACb,6DACA,uDACJ;wCACF,YAAY;4CAAE,OAAO;wCAAK;wCAC1B,YAAY;4CAAE,UAAU;wCAAI;;0DAE5B,6LAAC;0FAAY;0DAA2B,QAAQ,IAAI;;;;;;4CAEnD,QAAQ,IAAI,KAAK,6BAChB,6LAAC;0FAAc;;oDACZ,QAAQ,OAAO,kBACd,6LAAC;kGAAe;kEACb,QAAQ,OAAO;;;;;;oDAGnB,QAAQ,QAAQ,kBACf,6LAAC,uMAAM,CAAC,MAAM;wDACZ,WAAU;wDACV,YAAY;4DAAE,OAAO;wDAAK;wDAC1B,UAAU;4DAAE,OAAO;wDAAK;wDACxB,SAAS;4DACP,MAAM,QAAQ,IAAI,MAAM,QAAQ,QAAQ;4DACxC,MAAM,IAAI;wDACZ;kEACD;;;;;;;;;;;;;;;;;;mCApCJ,QAAQ,EAAE;;;;;4BA8ClB,2BACC,6LAAC,uMAAM,CAAC,GAAG;gCACT,WAAU;gCACV,SAAS;oCAAE,SAAS;gCAAE;gCACtB,SAAS;oCAAE,SAAS;gCAAE;gCACtB,MAAM;oCAAE,SAAS;gCAAE;0CAEnB,cAAA,6LAAC;8EAAc;8CACZ;wCAAC;wCAAG;wCAAG;qCAAE,CAAC,GAAG,CAAC,CAAC,kBACd,6LAAC,uMAAM,CAAC,GAAG;4CAET,WAAU;4CACV,SAAS;gDACP,GAAG;oDAAC;oDAAG,CAAC;oDAAI;iDAAE;4CAChB;4CACA,YAAY;gDACV,UAAU;gDACV,QAAQ;gDACR,OAAO,IAAI;4CACb;2CATK;;;;;;;;;;;;;;;;;;;;;kCAiBjB,6LAAC;wBAAI,KAAK;;;;;;;;;;;;;0BAGZ,6LAAC,+MAAe;0BACb,2BAAa,6LAAC;;;;;;;;;;0BAGjB,6LAAC,uMAAM,CAAC,GAAG;gBACT,WAAU;gBACV,SAAS;oBAAE,GAAG;gBAAI;gBAClB,SAAS;oBAAE,GAAG;gBAAE;gBAChB,YAAY;oBAAE,UAAU;oBAAK,OAAO;gBAAI;;kCAExC,6LAAC;kEAAc;;0CACb,6LAAC,uMAAM,CAAC,KAAK;gCACX,MAAK;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;gCAC5C,YAAY,CAAC;oCACX,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,QAAQ,EAAE;wCACpC,EAAE,cAAc;wCAChB,kBAAkB;oCACpB;gCACF;gCACA,aAAY;gCACZ,WAAU;gCACV,YAAY;oCAAE,OAAO;gCAAK;;;;;;0CAG5B,6LAAC,uMAAM,CAAC,MAAM;gCACZ,SAAS,IAAM,kBAAkB;gCACjC,UAAU,CAAC,UAAU,IAAI,MAAM;gCAC/B,WAAU;gCACV,YAAY;oCAAE,OAAO;gCAAK;gCAC1B,UAAU;oCAAE,OAAO;gCAAK;0CAExB,cAAA,6LAAC,6MAAI;oCAAC,WAAU;;;;;;;;;;;;;;;;;kCAIpB,6LAAC;wBACC,iBAAiB,CAAC,OAAS,kBAAkB;wBAC7C,WAAW;;;;;;;;;;;;;;;;;;;;;;AAqBrB;GAxSwB;;QAMqB;;;KANrB"}}]
}