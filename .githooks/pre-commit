#!/bin/sh
# Pre-commit hook: block committing files larger than 5 MB
# Install by running: `git config core.hooksPath .githooks`

MAX_BYTES=$((5 * 1024 * 1024))

# Get list of staged files (Added, Copied, Modified)
files=$(git diff --cached --name-only --diff-filter=ACM)

if [ -z "$files" ]; then
  exit 0
fi

exit_code=0
for f in $files; do
  # skip deleted or non-existent paths
  if [ ! -f "$f" ]; then
    continue
  fi
  # get file size in bytes
  size=$(stat -c%s "$f" 2>/dev/null || wc -c <"$f" 2>/dev/null)
  if [ "$size" -gt "$MAX_BYTES" ]; then
    echo "ERROR: Staged file '$f' is larger than 5 MB ($size bytes)."
    echo "Remove the file from the commit, use Git LFS, or keep it outside the repo."
    exit_code=1
  fi
done

if [ "$exit_code" -ne 0 ]; then
  echo "Commit aborted due to oversized files."
  exit 1
fi

exit 0
