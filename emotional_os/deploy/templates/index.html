<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FirstPerson - Personal AI Companion</title>
    <link rel="icon" type="image/svg+xml" href="/static/graphics/FirstPerson-Logo.svg">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .splash-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 400px;
            text-align: center;
        }

        .logo-section {
            margin-bottom: 2rem;
        }

        .logo-section img {
            width: 200px;
            height: auto;
            margin-bottom: 1rem;
        }

        .logo-fallback {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .logo-text {
            font-size: 2rem;
            font-weight: 300;
            letter-spacing: 4px;
            color: #2E2E2E;
            margin: 0.5rem 0 0.2rem 0;
        }

        .logo-subtitle {
            font-size: 1rem;
            color: #666;
            letter-spacing: 2px;
            font-weight: 300;
            text-transform: uppercase;
            line-height: 1.2;
        }

        .auth-section {
            margin: 2rem 0;
        }

        .auth-questions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .auth-question {
            font-size: 0.9rem;
            color: #666;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .btn {
            width: 140px;
            height: 35px;
            border: 2px solid #2E2E2E;
            background-color: #2E2E2E;
            border-radius: 8px;
            font-size: 0.8rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            background-color: white;
            color: #2E2E2E;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 46, 46, 0.2);
        }

        .quick-access {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #ddd;
        }

        .quick-title {
            color: #999;
            font-size: 0.8rem;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-section {
            display: none;
            margin-top: 1rem;
        }

        .form-section.active {
            display: block;
        }

        .form-title {
            font-size: 1.1rem;
            color: #2E2E2E;
            margin-bottom: 1rem;
            font-weight: 300;
        }

        .form-group {
            margin-bottom: 1rem;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 0.2rem;
            color: #666;
            font-size: 0.8rem;
        }

        .form-input {
            width: 100%;
            border-radius: 30px;
            border: 2px solid #ddd;
            padding: 8px 15px;
            font-size: 0.85rem;
            text-align: center;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            border-color: #666;
            box-shadow: 0 0 0 1px #666;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .success-message {
            color: #27ae60;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .back-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="splash-container">
        <!-- Logo Section -->
        <div class="logo-section">
            <img src="/static/graphics/FirstPerson-Logo.svg" alt="FirstPerson Logo"
                onerror="this.style.display='none'; document.querySelector('.logo-fallback').style.display='block';">
            <div class="logo-fallback" style="display: none;" aria-hidden="true">
                <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 378 378" width="96"
                    height="96">
                    <defs>
                        <style>
                            .st0 {
                                fill: #fff;
                            }
                        </style>
                    </defs>
                    <path class="st0"
                        d="M-905.18-1316.56V-292.56h-1024v-1024h1024ZM-1425.87-1122.45c-84.26,7.91-99.11,127.53-20.3,157.57,76.96,29.34,145.31-58.28,95.84-124.82-17.61-23.68-46.21-35.51-75.54-32.75h0ZM-1568.28-652.47c3.79,3.55,9.39,0,12.65-2.32,30.61-21.78,59.08-51.09,89.52-73.32,4.93-3.6,8.62-6.78,15.08-6.91,38.43-.73,107.66,7.97,141.23-7.61,44.22-20.52,52.29-64.5,49.01-108.92-3.03-40.98-39.18-78.46-80.42-81.42-48.76-3.5-101.68,2.69-150.88.05-40.44,4.31-73.72,35.68-78.42,76.43l-.07,196.84c-.01,1.87,1.05,6,2.31,7.18h-.01ZM-1679.7-617.01c-16.01,3.25-10.89,30.23,8.32,24.3,12.65-3.9,9.73-27.97-8.32-24.3ZM-1695.41-612.24h-62.94v98.9h21.98v-37.96h37.96v-17.98h-37.96c1.28-6.47-1.48-17.21-.6-22.91.15-.95-.01-1.44,1.1-2.07h40.46v-17.98ZM-1464.64-545.31h20.48c6.6,0,19.07-6.44,23.45-11.51,18.99-21.97,3.57-55.42-25.45-55.42h-39.46v98.9h20.98v-31.97ZM-1515.59-604.25c-6.76-2.01-13.13.21-19.98,0v19.98h-9.99v16.98h9.99v36.46c0,.4,2.07,6.56,2.49,7.5,5.98,13.31,23.78,13.06,35.89,10.1,1.24-.87-.11-15.84-.89-17.13-1.22-2.03-4.65.92-7.03,1.1-5.04.38-10.48-3.38-10.48-8.56v-29.47c1.08-.37,2.19,1,2.5,1h15.48l1-17.98h-18.98v-19.98ZM-1636.97-584.27c-5.32.73-11.99-.53-17.48,0v70.93h19.98v-37.46c0-1.23,2-6.75,2.79-8.2,3.86-7.07,12.99-8.58,20.18-6.28l2.08-19.39c-9.84-3.87-19.97.81-25.55,9.39l-.5-9.98c-.36-.5-1.2.96-1.49,1h-.01ZM-1313.78-584.27h-18.98v70.93h19.98v-41.46c0-.37,3.07-5.84,3.57-6.42,4.23-4.91,13.47-6.28,19.4-4.07l2.01-19.97c-9.61-2.11-20.8.1-24.99,9.98-2.34-.65-.24-8.24-.99-8.98h0ZM-1549.55-562.29c.52-20.37-18.7-24.57-35.51-23.02-16.48,1.51-28.37,20.21-18.3,34.37,7.27,10.21,35.03,9.82,37.17,14.88,3.98,9.43-14.31,11.23-20.57,5.76-2.08-1.81-2.67-6.28-4.39-6.88l-17.35.87c1.44,33.13,64.21,34.05,61.94-.48-1.32-20.06-22.94-16.94-35.66-22.3-10.99-4.63-3.7-12.27,6.21-11.21,7.65.82,8.13,8.19,10.1,8.89l16.36-.87h0ZM-1391.71-541.31h49.95c2.06-29.03-13.02-47.85-43.37-43.87-32.23,4.22-37.42,57.36-7.61,70.38,19.59,8.55,42.57,1.84,49.98-19.02l-19.95-2.49c-5.33,14.61-27.19,10.28-29-4.99h0ZM-1227.86-562.29c.45-21.34-19.08-24.72-36.46-22.97-22.36,2.26-30.09,30.82-8.49,40.44,6.42,2.86,22.73,4.61,26.25,7.45,2.19,1.76,2.25,6.47.02,8.11-6.56,4.85-21.89,1.52-22.9-8.12l-17.38,1.07c1.06,34.72,66.21,33.63,60.86-3.41-2.82-19.5-34.61-14.54-39.78-22.2-4.68-6.92,10.43-11.55,16.95-5.92,2.36,2.04,2.24,4.22,3.54,6.62l17.38-1.06h.01ZM-1193.14-585.01c-33.03,4.74-38.52,57.65-7.11,70.52,31.8,13.03,60.32-13.73,51.24-46.25-5.74-20.54-24.34-27.12-44.13-24.28h0ZM-1073.02-513.34c.27-.73-1-1.19-1-1.5v-49.95c0-1.64-3.35-9.65-4.56-11.42-9.3-13.71-31.83-11.67-41.39.93v-8.99h-18.99v70.93h19.98v-42.46c0-4.05,5.5-10.1,9.54-11.43,12.57-4.13,15.74,6.29,16.47,16.39.87,12.12-.72,25.27-.04,37.5h19.99ZM-1666.44-584.27h-20.98c-.27.73,1,1.19,1,1.5v69.43h19.98v-70.93Z" />
                    <g>
                        <path
                            d="M75.39,363.16c-.93-.87-1.72-3.94-1.71-5.33l.05-146.24c3.5-30.27,28.22-53.58,58.26-56.78,41.9-.86,75.9-1.4,112.09-.04,30.64,2.2,57.5,30.05,59.75,60.49,2.44,33-3.56,65.67-36.41,80.92-24.94,11.58-76.37,5.11-104.93,5.66-4.8.09-7.54,2.46-11.2,5.13-22.61,16.52-43.77,38.29-66.51,54.48-2.42,1.73-6.58,4.36-9.4,1.72h.01ZM99.7,312.88c1.37.18,2.32-.78,3.33-1.49,6.36-4.5,13.08-11.26,19.33-16.3,8.35-6.75,16.81-13.43,25.4-19.88,29.94-2.03,62.22,2.08,91.88-.15,18.47-1.39,35.24-15.55,36.74-34.52,2.2-27.87-3.32-51.68-33.8-58.28-33.69-.62-62.69-.82-99.32-.47-24.77.56-43.44,15.71-43.61,41.65-.01,35.68,0,58.63.84,84.65-.06,1.67-.76,3.13-.77,4.79h-.02Z" />
                        <path
                            d="M181.19,14c21.79-2.05,43.04,6.74,56.12,24.33,36.75,49.43-14.03,114.53-71.21,92.73-58.55-22.32-47.52-111.19,15.08-117.07h.01Z" />
                    </g>
                </svg>
            </div>
            <div class="logo-text">FirstPerson</div>
            <div class="logo-subtitle">Personal AI<br>Companion</div>
        </div>

        <!-- Main Auth Section -->
        <div id="main-auth" class="auth-section">
            <div class="auth-questions">
                <span class="auth-question">existing user?</span>
                <span class="auth-question">new user?</span>
            </div>
            <div class="auth-buttons">
                <button class="btn" onclick="showLogin()">Sign In</button>
                <button class="btn" onclick="showRegister()">Register Now</button>
            </div>

            <div class="quick-access">
                <div class="quick-title">Quick Access</div>
                <button class="btn" onclick="demoLogin()">⚡ Demo Mode</button>
            </div>
        </div>

        <!-- Login Form -->
        <div id="login-form" class="form-section">
            <button class="back-btn" onclick="showMain()">← Back</button>
            <div class="form-title">Sign In</div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">login:</label>
                    <input type="text" class="form-input" id="login-username" placeholder="username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">password:</label>
                    <input type="password" class="form-input" id="login-password" placeholder="password" required>
                </div>
                <button type="submit" class="btn">Sign In</button>
                <div id="login-message"></div>
            </form>
        </div>

        <!-- Register Form -->
        <div id="register-form" class="form-section">
            <button class="back-btn" onclick="showMain()">← Back</button>
            <div class="form-title">Create Account</div>
            <form onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label class="form-label">login:</label>
                    <input type="text" class="form-input" id="register-username" placeholder="choose username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">password:</label>
                    <input type="password" class="form-input" id="register-password" placeholder="choose password"
                        required minlength="6">
                </div>
                <div class="form-group">
                    <label class="form-label">confirm:</label>
                    <input type="password" class="form-input" id="register-confirm" placeholder="confirm password"
                        required>
                </div>
                <button type="submit" class="btn">Register Now</button>
                <div id="register-message"></div>
            </form>
        </div>
    </div>

    <script>
        // Navigation functions
        function showMain() {
            document.getElementById('main-auth').style.display = 'block';
            document.getElementById('login-form').classList.remove('active');
            document.getElementById('register-form').classList.remove('active');
        }

        function showLogin() {
            document.getElementById('main-auth').style.display = 'none';
            document.getElementById('login-form').classList.add('active');
            document.getElementById('register-form').classList.remove('active');
        }

        function showRegister() {
            document.getElementById('main-auth').style.display = 'none';
            document.getElementById('login-form').classList.remove('active');
            document.getElementById('register-form').classList.add('active');
        }

        // Authentication functions
        async function handleLogin(event) {
            event.preventDefault();
            const container = document.querySelector('.splash-container');
            const messageDiv = document.getElementById('login-message');

            container.classList.add('loading');
            messageDiv.innerHTML = '';

            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    messageDiv.innerHTML = '<div class="success-message">Welcome back!</div>';
                    // Store session data
                    localStorage.setItem('firstperson_token', data.token);
                    localStorage.setItem('firstperson_user_id', data.user_id);
                    localStorage.setItem('firstperson_username', data.username);

                    // Redirect to chat app
                    setTimeout(() => {
                        window.location.href = '/app';
                    }, 1000);
                } else {
                    messageDiv.innerHTML = `<div class="error-message">${data.detail}</div>`;
                }
            } catch (error) {
                messageDiv.innerHTML = '<div class="error-message">Login failed. Please try again.</div>';
            } finally {
                container.classList.remove('loading');
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const container = document.querySelector('.splash-container');
            const messageDiv = document.getElementById('register-message');

            container.classList.add('loading');
            messageDiv.innerHTML = '';

            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm').value;

            if (password !== confirmPassword) {
                messageDiv.innerHTML = '<div class="error-message">Passwords do not match</div>';
                container.classList.remove('loading');
                return;
            }

            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username,
                        password,
                        confirm_password: confirmPassword
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    messageDiv.innerHTML = '<div class="success-message">Account created! Please sign in.</div>';
                    setTimeout(() => {
                        showLogin();
                    }, 2000);
                } else {
                    messageDiv.innerHTML = `<div class="error-message">${data.detail}</div>`;
                }
            } catch (error) {
                messageDiv.innerHTML = '<div class="error-message">Registration failed. Please try again.</div>';
            } finally {
                container.classList.remove('loading');
            }
        }

        function demoLogin() {
            // Create demo session
            const demoUserId = 'demo_' + Date.now();
            const demoToken = btoa(JSON.stringify({
                username: 'demo_user',
                user_id: demoUserId,
                created: new Date().toISOString(),
                expires: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString()
            }));

            localStorage.setItem('firstperson_token', demoToken);
            localStorage.setItem('firstperson_user_id', demoUserId);
            localStorage.setItem('firstperson_username', 'demo_user');

            window.location.href = '/app';
        }

        // Check for existing session on page load
        window.addEventListener('load', () => {
            const token = localStorage.getItem('firstperson_token');
            if (token) {
                // Validate token and redirect if valid
                fetch(`/api/validate-session?token=${encodeURIComponent(token)}`)
                    .then(response => {
                        if (response.ok) {
                            window.location.href = '/app';
                        }
                    })
                    .catch(() => {
                        // Invalid token, clear storage
                        localStorage.clear();
                    });
            }
        });
    </script>
</body>

</html>